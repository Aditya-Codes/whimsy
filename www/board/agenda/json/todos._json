#
# Secretary post-meeting todo list
#

agenda = "board_agenda_#{params[:file].gsub('-', '_')}.txt"
agenda.untaint if params[:file] =~ /^\d+-\d+\d+/
cache = AGENDA_CACHE[agenda]

transitioning = []

Dir.chdir(FOUNDATION_BOARD) do
  cache = AGENDA_CACHE.parse(agenda) if cache[:mtime] != File.mtime(agenda)
end

if cache and cache[:parsed]
  cache[:parsed].each do |item|
    if item[:attach] =~ /^7\w$/ and item['title'] =~ /^Change .*? Chair$/
      transitioning += item['people'].keys
    end
  end
end

transitioning.map! {|id| ASF::Person.find(id)}

add = transitioning - ASF.pmc_chairs
remove = ASF.pmc_chairs - ASF::Committee.list.map(&:chair) - transitioning

_add add.map {|person| {id: person.id, name: person.public_name}}
_remove remove.map {|person| {id: person.id, name: person.public_name}}
